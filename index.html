<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>3D –ü–µ–∫–∞—Ä–Ω—è - Ultra Edition</title>
<style>
  body { margin: 0; overflow: hidden; background: #1a1a1a; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
  
  #ui {
    position: absolute;
    top: 20px; left: 20px;
    color: #fff;
    background: rgba(30, 30, 30, 0.85);
    backdrop-filter: blur(5px);
    padding: 20px;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.5);
    z-index: 10;
    width: 220px;
    border: 1px solid rgba(255,255,255,0.1);
    user-select: none;
  }

  h1 {
    margin: 0 0 15px 0;
    font-size: 20px;
    color: #ffd700;
    text-align: center;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  #stats {
    font-size: 14px;
    line-height: 1.6;
    margin-bottom: 20px;
    color: #ddd;
  }

  button {
    width: 100%;
    margin-bottom: 10px;
    padding: 12px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }

  #bakeBtn {
    background: linear-gradient(135deg, #e67e22, #d35400);
    color: white;
    box-shadow: 0 4px 0 #a04000;
  }
  #bakeBtn:active:not(:disabled) {
    transform: translateY(2px);
    box-shadow: 0 1px 0 #a04000;
  }

  #sellBtn {
    background: linear-gradient(135deg, #27ae60, #219150);
    color: white;
    box-shadow: 0 4px 0 #1e8449;
  }
  #sellBtn:active:not(:disabled) {
    transform: translateY(2px);
    box-shadow: 0 1px 0 #1e8449;
  }

  button:disabled {
    background: #555;
    color: #888;
    box-shadow: none;
    cursor: not-allowed;
    transform: none;
  }
</style>
</head>
<body>

<div id="ui">
  <h1>ü•ñ –ü–µ–∫–∞—Ä–Ω—è</h1>
  <div id="stats"></div>
  <button id="bakeBtn"><span>üî•</span> –ü–µ—á—å —Ö–ª–µ–±</button>
  <button id="sellBtn" disabled><span>üí∞</span> –ü—Ä–æ–¥–∞—Ç—å</button>
</div>

<!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Three.js -->
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>

<script>
// ---------------- –ù–ê–°–¢–†–û–ô–ö–ò –°–¶–ï–ù–´ ----------------
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x2c3e50);
scene.fog = new THREE.Fog(0x2c3e50, 10, 25); // –¢—É–º–∞–Ω –¥–ª—è –≥–ª—É–±–∏–Ω—ã

const camera = new THREE.PerspectiveCamera(50, window.innerWidth/window.innerHeight, 0.1, 100);
camera.position.set(0, 5, 9);
camera.lookAt(0, 0.5, 0);

const renderer = new THREE.WebGLRenderer({antialias: true});
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setPixelRatio(window.devicePixelRatio);
renderer.shadowMap.enabled = true; // –í–∫–ª—é—á–∞–µ–º —Ç–µ–Ω–∏!
renderer.shadowMap.type = THREE.PCFSoftShadowMap;
document.body.appendChild(renderer.domElement);

// ---------------- –ú–ê–¢–ï–†–ò–ê–õ–´ ----------------
const materials = {
  floor: new THREE.MeshStandardMaterial({color: 0x5d4037, roughness: 0.8}),
  wall: new THREE.MeshStandardMaterial({color: 0xfdf2e9, roughness: 0.9}),
  woodDark: new THREE.MeshStandardMaterial({color: 0x3e2723, roughness: 0.9}),
  woodLight: new THREE.MeshStandardMaterial({color: 0x8d6e63, roughness: 0.7}),
  metal: new THREE.MeshStandardMaterial({color: 0x2c3e50, roughness: 0.4, metalness: 0.6}),
  glass: new THREE.MeshPhysicalMaterial({color: 0x88ccff, transparent: true, opacity: 0.3, roughness: 0, metalness: 0.1}),
  bread: new THREE.MeshStandardMaterial({color: 0xffa000, roughness: 0.6}),
  skin: new THREE.MeshStandardMaterial({color: 0xffcc80}),
  shirt: new THREE.MeshStandardMaterial({color: 0x3498db}),
  pants: new THREE.MeshStandardMaterial({color: 0x2c3e50}),
  hair: new THREE.MeshStandardMaterial({color: 0x000000}),
  gold: new THREE.MeshStandardMaterial({color: 0xffd700, metalness: 0.8, roughness: 0.2})
};

// ---------------- –°–í–ï–¢ ----------------
const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
scene.add(ambientLight);

const sunLight = new THREE.DirectionalLight(0xfffae0, 1.2);
sunLight.position.set(5, 10, 5);
sunLight.castShadow = true;
sunLight.shadow.mapSize.width = 1024;
sunLight.shadow.mapSize.height = 1024;
sunLight.shadow.camera.near = 0.5;
sunLight.shadow.camera.far = 20;
scene.add(sunLight);

// –¢–µ–ø–ª—ã–π —Å–≤–µ—Ç –æ—Ç –ø–µ—á–∏ (—Å–Ω–∞—á–∞–ª–∞ –≤—ã–∫–ª—é—á–µ–Ω)
const ovenLight = new THREE.PointLight(0xffaa00, 0, 4);
ovenLight.position.set(-2, 1.5, -2);
scene.add(ovenLight);

// ---------------- –û–ö–†–£–ñ–ï–ù–ò–ï ----------------

// –ü–æ–ª
const floor = new THREE.Mesh(new THREE.PlaneGeometry(12, 12), materials.floor);
floor.rotation.x = -Math.PI / 2;
floor.receiveShadow = true;
scene.add(floor);

// –°—Ç–µ–Ω—ã
function createWall(x, z, ry, width) {
  const wallGroup = new THREE.Group();
  const mesh = new THREE.Mesh(new THREE.BoxGeometry(width, 4, 0.2), materials.wall);
  mesh.castShadow = true;
  mesh.receiveShadow = true;
  mesh.position.y = 2;
  wallGroup.add(mesh);

  // –ü–ª–∏–Ω—Ç—É—Å
  const skirting = new THREE.Mesh(new THREE.BoxGeometry(width, 0.2, 0.25), materials.woodDark);
  skirting.position.y = 0.1;
  wallGroup.add(skirting);

  wallGroup.position.set(x, 0, z);
  wallGroup.rotation.y = ry;
  scene.add(wallGroup);
  return wallGroup;
}

createWall(0, -4, 0, 10); // –ó–∞–¥–Ω—è—è
createWall(-5, 0, Math.PI/2, 8); // –õ–µ–≤–∞—è
createWall(5, 0, Math.PI/2, 8); // –ü—Ä–∞–≤–∞—è

// –û–∫–Ω–æ –Ω–∞ –∑–∞–¥–Ω–µ–π —Å—Ç–µ–Ω–µ
const windowFrame = new THREE.Mesh(new THREE.BoxGeometry(3, 2, 0.3), materials.woodLight);
windowFrame.position.set(2, 2.5, -3.9);
scene.add(windowFrame);
const windowGlass = new THREE.Mesh(new THREE.PlaneGeometry(2.8, 1.8), materials.glass);
windowGlass.position.set(2, 2.5, -3.74);
scene.add(windowGlass);


// ---------------- –ú–ï–ë–ï–õ–¨ (–§–£–ù–ö–¶–ò–ò) ----------------

function createTable(x, z, width, depth) {
  const group = new THREE.Group();
  
  // –°—Ç–æ–ª–µ—à–Ω–∏—Ü–∞
  const top = new THREE.Mesh(new THREE.BoxGeometry(width, 0.1, depth), materials.woodLight);
  top.position.y = 0.85;
  top.castShadow = true;
  top.receiveShadow = true;
  group.add(top);

  // –ù–æ–∂–∫–∏
  const legGeo = new THREE.BoxGeometry(0.1, 0.8, 0.1);
  const legPositions = [
    {x: width/2 - 0.1, z: depth/2 - 0.1},
    {x: -width/2 + 0.1, z: depth/2 - 0.1},
    {x: width/2 - 0.1, z: -depth/2 + 0.1},
    {x: -width/2 + 0.1, z: -depth/2 + 0.1},
  ];

  legPositions.forEach(pos => {
    const leg = new THREE.Mesh(legGeo, materials.woodDark);
    leg.position.set(pos.x, 0.4, pos.z);
    leg.castShadow = true;
    leg.receiveShadow = true;
    group.add(leg);
  });

  group.position.set(x, 0, z);
  scene.add(group);
  return group;
}

// –°—Ç–æ–ª –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏
createTable(0, 1.5, 3, 1.5);

// –ü—Ä–∏–ª–∞–≤–æ–∫
const counterGroup = createTable(0, 3.5, 4, 1.2);
// –ó–∞–∫—Ä–æ–µ–º –ø–µ—Ä–µ–¥ –ø—Ä–∏–ª–∞–≤–∫–∞ –ø–∞–Ω–µ–ª—å—é
const frontPanel = new THREE.Mesh(new THREE.BoxGeometry(3.8, 0.8, 0.05), materials.woodLight);
frontPanel.position.set(0, 0.4, 0.55); // –ß—É—Ç—å —Å–ø–µ—Ä–µ–¥–∏
frontPanel.castShadow = true;
counterGroup.add(frontPanel);


// ---------------- –î–ï–¢–ê–õ–ò–ó–ò–†–û–í–ê–ù–ù–ê–Ø –ü–ï–ß–¨ ----------------
const ovenGroup = new THREE.Group();

// –ö–æ—Ä–ø—É—Å
const body = new THREE.Mesh(new THREE.BoxGeometry(2, 2.2, 1.8), materials.metal);
body.position.y = 1.1;
body.castShadow = true;
body.receiveShadow = true;
ovenGroup.add(body);

// –û–∫–Ω–æ –ø–µ—á–∏ (—Å–≤–µ—Ç—è—â–µ–µ—Å—è –∏–∑–Ω—É—Ç—Ä–∏ –ø—Ä–∏ –≤—ã–ø–µ—á–∫–µ)
const ovenWindow = new THREE.Mesh(new THREE.BoxGeometry(1.2, 0.8, 0.1), materials.glass);
ovenWindow.position.set(0, 1.3, 0.91);
ovenGroup.add(ovenWindow);

// –í–Ω—É—Ç—Ä–µ–Ω–Ω–æ—Å—Ç—å (—á—Ç–æ–±—ã —Å—Ç–µ–∫–ª–æ –Ω–µ –±—ã–ª–æ —á–µ—Ä–Ω—ã–º)
const interior = new THREE.Mesh(new THREE.BoxGeometry(1.1, 0.7, 0.1), new THREE.MeshBasicMaterial({color: 0x222222}));
interior.position.set(0, 1.3, 0.85);
ovenGroup.add(interior);

// –†—É—á–∫–∞
const handle = new THREE.Mesh(new THREE.CylinderGeometry(0.05, 0.05, 1.2), materials.woodLight);
handle.rotation.z = Math.PI/2;
handle.position.set(0, 1.8, 1.0);
ovenGroup.add(handle);

// –ù–æ–∂–∫–∏ –ø–µ—á–∏
const footGeo = new THREE.CylinderGeometry(0.1, 0.1, 0.2);
[ [-0.8, -0.8], [0.8, -0.8], [-0.8, 0.8], [0.8, 0.8] ].forEach(pos => {
  const foot = new THREE.Mesh(footGeo, materials.metal);
  foot.position.set(pos[0], 0.1, pos[1]);
  ovenGroup.add(foot);
});

ovenGroup.position.set(-3.5, 0, -2);
ovenGroup.rotation.y = 0.5; // –ù–µ–º–Ω–æ–≥–æ –ø–æ–≤–µ—Ä–Ω–µ–º
scene.add(ovenGroup);

// –î—ã–º–æ—Ö–æ–¥
const chimney = new THREE.Mesh(new THREE.CylinderGeometry(0.2, 0.2, 3), materials.metal);
chimney.position.set(-3.5, 3.5, -2.5);
scene.add(chimney);


// ---------------- –•–õ–ï–ë (–ë–ê–¢–û–ù) ----------------
function createLoaf() {
  const group = new THREE.Group();
  const main = new THREE.Mesh(
    new THREE.BoxGeometry(0.6, 0.3, 0.35), 
    materials.bread
  );
  // –°–∫—Ä—É–≥–ª–∏–º –Ω–µ–º–Ω–æ–≥–æ —á–µ—Ä–µ–∑ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã scale –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –≥–µ–æ–º–µ—Ç—Ä–∏–µ–π
  // –í ThreeJS core –Ω–µ—Ç RoundedBox –±–µ–∑ –∞–¥–¥–æ–Ω–æ–≤, —Å—ã–º–∏—Ç–∏—Ä—É–µ–º –¥–µ—Ç–∞–ª—è–º–∏
  main.geometry.translate(0, 0.15, 0);
  main.castShadow = true;
  
  // –ù–∞–¥—Ä–µ–∑—ã —Å–≤–µ—Ä—Ö—É
  for(let i=-1; i<=1; i++) {
    const cut = new THREE.Mesh(new THREE.BoxGeometry(0.05, 0.02, 0.25), new THREE.MeshStandardMaterial({color: 0xe67e22}));
    cut.position.set(i*0.15, 0.3, 0);
    cut.rotation.y = 0.2;
    main.add(cut);
  }
  
  group.add(main);
  return group;
}

const breadMesh = createLoaf();
breadMesh.visible = false;
breadMesh.position.set(0, 0.9, 1.5);
scene.add(breadMesh);


// ---------------- –ü–ï–†–°–û–ù–ê–ñ (–ö–õ–ò–ï–ù–¢) ----------------
function createHuman() {
  const group = new THREE.Group();
  
  // –ì–æ–ª–æ–≤–∞
  const head = new THREE.Mesh(new THREE.BoxGeometry(0.25, 0.28, 0.25), materials.skin);
  head.position.y = 1.55;
  head.castShadow = true;
  group.add(head);

  // –í–æ–ª–æ—Å—ã
  const hair = new THREE.Mesh(new THREE.BoxGeometry(0.27, 0.1, 0.27), materials.hair);
  hair.position.y = 1.68;
  group.add(hair);

  // –¢–µ–ª–æ
  const body = new THREE.Mesh(new THREE.BoxGeometry(0.4, 0.5, 0.25), materials.shirt);
  body.position.y = 1.15;
  body.castShadow = true;
  group.add(body);

  // –ù–æ–≥–∏
  const leftLeg = new THREE.Mesh(new THREE.BoxGeometry(0.15, 0.9, 0.15), materials.pants);
  leftLeg.position.set(-0.11, 0.45, 0);
  leftLeg.castShadow = true;
  group.add(leftLeg);

  const rightLeg = new THREE.Mesh(new THREE.BoxGeometry(0.15, 0.9, 0.15), materials.pants);
  rightLeg.position.set(0.11, 0.45, 0);
  rightLeg.castShadow = true;
  group.add(rightLeg);

  // –†—É–∫–∏
  const leftArm = new THREE.Mesh(new THREE.BoxGeometry(0.12, 0.4, 0.12), materials.skin);
  leftArm.position.set(-0.3, 1.2, 0);
  group.add(leftArm);

  const rightArm = new THREE.Mesh(new THREE.BoxGeometry(0.12, 0.4, 0.12), materials.skin);
  rightArm.position.set(0.3, 1.2, 0);
  group.add(rightArm);

  return group;
}

const client = createHuman();
client.position.set(0, 0, 4.5); 
client.visible = false;
scene.add(client);


// ---------------- –õ–û–ì–ò–ö–ê –ò–ì–†–´ ----------------
let breadCount = 0;
let money = 0;
let baking = false;
let bakeTimer = 0;
let clientHere = false;

const statsEl = document.getElementById("stats");
const bakeBtn = document.getElementById("bakeBtn");
const sellBtn = document.getElementById("sellBtn");

function updateUI() {
  statsEl.innerHTML = `
    <b>–ù–∞ —Å–∫–ª–∞–¥–µ:</b> ${breadCount} —à—Ç.<br>
    <b>–ö–∞—Å—Å–∞:</b> $${money}<br>
    <b>–°—Ç–∞—Ç—É—Å:</b> ${clientHere ? "<span style='color:#3498db'>–ö–ª–∏–µ–Ω—Ç –∂–¥–µ—Ç</span>" : "–ü—É—Å—Ç–æ"}
  `;
  
  sellBtn.disabled = !(clientHere && breadCount > 0);
  
  // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å —Ö–ª–µ–±–∞ –Ω–∞ —Å—Ç–æ–ª–µ
  breadMesh.visible = breadCount > 0;
}

bakeBtn.onclick = () => {
  if (!baking) {
    baking = true;
    bakeTimer = 3;
    bakeBtn.disabled = true;
    bakeBtn.innerHTML = "<span>‚è≥</span> –ü–µ—á–µ–º...";
    
    // –≠—Ñ—Ñ–µ–∫—Ç—ã –≤—ã–ø–µ—á–∫–∏
    ovenLight.intensity = 2; // –í–∫–ª—é—á–∞–µ–º —Å–≤–µ—Ç –≤–Ω—É—Ç—Ä–∏
    interior.material.color.setHex(0xff5500); // "–ù–∞–≥—Ä–µ–≤–∞–µ–º" —Ç—ç–Ω—ã
  }
};

sellBtn.onclick = () => {
  if (clientHere && breadCount > 0) {
    breadCount--;
    money += 15; // –ü–æ–¥–Ω—è–ª–∏ —Ü–µ–Ω—ã –∑–∞ –∫–∞—á–µ—Å—Ç–≤–æ ;)
    clientHere = false;
    client.visible = false;
    
    // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–æ–¥–∞–∂–∏ (–º–æ–Ω–µ—Ç–∫–∏ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ—Ç–æ–º, –ø–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ —Å–∫—Ä–æ–µ–º)
    updateUI();
  }
};


// ---------------- –ê–ù–ò–ú–ê–¶–ò–Ø ----------------
let clientTimer = 0;

function animate() {
  requestAnimationFrame(animate);

  const time = Date.now() * 0.001;

  // –õ–æ–≥–∏–∫–∞ –≤—ã–ø–µ—á–∫–∏
  if (baking) {
    bakeTimer -= 0.016;
    
    // –ü–µ—á—å –≤–∏–±—Ä–∏—Ä—É–µ—Ç
    ovenGroup.rotation.z = (Math.sin(time * 20) * 0.02);
    // –°–≤–µ—Ç –ø—É–ª—å—Å–∏—Ä—É–µ—Ç
    ovenLight.intensity = 1.5 + Math.sin(time * 10) * 0.5;

    if (bakeTimer <= 0) {
      baking = false;
      breadCount++;
      
      // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–µ—á–∏
      bakeBtn.disabled = false;
      bakeBtn.innerHTML = "<span>üî•</span> –ü–µ—á—å —Ö–ª–µ–±";
      ovenGroup.rotation.z = 0;
      ovenLight.intensity = 0;
      interior.material.color.setHex(0x222222);
      
      updateUI();
    }
  }

  // –õ–æ–≥–∏–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞
  if (!clientHere) {
    clientTimer += 0.016;
    if (clientTimer > 3) { // –ë—ã—Å—Ç—Ä–µ–µ –ø—Ä–∏—Ö–æ–¥—è—Ç
      clientTimer = 0;
      clientHere = true;
      client.visible = true;
      
      // –°–ª—É—á–∞–π–Ω—ã–π —Ü–≤–µ—Ç —Ä—É–±–∞—à–∫–∏ –¥–ª—è —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è
      const colors = [0x3498db, 0xe74c3c, 0x2ecc71, 0x9b59b6];
      client.children[2].material = new THREE.MeshStandardMaterial({
        color: colors[Math.floor(Math.random() * colors.length)]
      });
      
      // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä—ã–∂–∫–∞ –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏
      client.position.y = 0;
      updateUI();
    }
  } else {
    // –ö–ª–∏–µ–Ω—Ç –ø–æ–∫–∞—á–∏–≤–∞–µ—Ç—Å—è –≤ –æ–∂–∏–¥–∞–Ω–∏–∏
    client.rotation.y = Math.sin(time * 1.5) * 0.1;
    client.position.y = Math.abs(Math.sin(time * 2)) * 0.05;
  }
  
  // –•–ª–µ–± –Ω–∞ —Å—Ç–æ–ª–µ –º–µ–¥–ª–µ–Ω–Ω–æ –∫—Ä—É—Ç–∏—Ç—Å—è, –ø—Ä–∏–≤–ª–µ–∫–∞—è –≤–Ω–∏–º–∞–Ω–∏–µ
  if(breadMesh.visible) {
    breadMesh.rotation.y = time * 0.5;
  }

  renderer.render(scene, camera);
}

updateUI();
animate();

window.addEventListener("resize", () => {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>
